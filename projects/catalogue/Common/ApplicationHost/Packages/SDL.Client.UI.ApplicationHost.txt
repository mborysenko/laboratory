/*70043,21740,17929,379,8002*//// <reference path="../../../../SDL.Client/SDL.Client.Core/ApplicationHost/ApplicationHost.d.ts" />
/// <reference path="../../../../SDL.Client/SDL.Client.Core/Types/Url.d.ts" />
/// <reference path="../../../../SDL.Client/SDL.Client.UI.Core.Knockout/Libraries/knockout/knockout.d.ts" />
/// <reference path="../../../../SDL.Client/SDL.Client.UI.Controls/TopBar/TopBar.d.ts" />
var SDL;
(function (SDL) {
    (function (Client) {
        (function (UI) {
            (function (ApplicationHost) {
                (function (ViewModels) {
                    (function (Navigation) {
                        var Url = SDL.Client.Types.Url;
                        var AppHost = SDL.Client.ApplicationHost;

                        Client.Xml.Namespaces["apphost"] = "http://www.sdl.com/2013/ApplicationHost";

                        ;

                        ;

                        ;

                        ;

                        ;

                        Navigation.navigationGroups = [];
                        Navigation.topNavigationGroup = null;
                        Navigation.homeNavigationItem;
                        Navigation.currentNavigationItem = ko.observable(null);
                        Navigation.currentNavigationGroup = ko.observable(null);
                        Navigation.authenticationTargetDisplays = null;
                        Navigation.navigationItemTargetDisplays = null;

                        var navigationItemsIndex = {};
                        var applicationAuthenticationTargetDisplays = {};
                        var applicationNavigationItemTargetDisplaysIndex = {};
                        var initialized = false;
                        var initCallbacks = [];
                        var topNavigationGroupItems = [];
                        var baseTopBarOptions = { ribbonTabs: undefined, selectedRibbonTabId: undefined, buttons: undefined };

                        function selectNavigationItem(navigationItem) {
                            if (navigationItem) {
                                if (navigationItem.external) {
                                    window.open(navigationItem.src());
                                } else if (Navigation.currentNavigationItem() != navigationItem) {
                                    Navigation.currentNavigationItem(navigationItem);
                                }
                            }
                        }
                        Navigation.selectNavigationItem = selectNavigationItem;

                        function setNavigationSelectionFromUrl(ignoreErrors) {
                            var newAppId = Url.getHashParameter(window.location.href, "app");
                            var newEntryId = Url.getHashParameter(window.location.href, "entry");
                            var newGroupId = Url.getHashParameter(window.location.href, "group");

                            if (newEntryId || (newAppId && !newGroupId)) {
                                var prevNavItem = Navigation.currentNavigationItem();
                                var prevApplicationEntryPoint = prevNavItem && prevNavItem.applicationEntryPoint;
                                var prevAppId = prevApplicationEntryPoint && prevApplicationEntryPoint.application.id || null;
                                var prevEntryId = prevApplicationEntryPoint && prevApplicationEntryPoint.id || null;
                                var prevSrc = prevNavItem && prevNavItem.src() || null;
                                var newSrc = Url.getHashParameter(window.location.href, "url") || "";

                                if (newAppId != prevAppId || newEntryId != prevEntryId || newSrc != prevSrc) {
                                    var newNavItem = getNavigationItemById(newEntryId, newAppId) || (newAppId ? getNavigationItemById(null, newAppId) : null);

                                    if (newNavItem && !newNavItem.external && !newNavItem.hidden()) {
                                        if (newNavItem.applicationEntryPoint) {
                                            if (ignoreErrors) {
                                                try  {
                                                    AppHost.ApplicationHost.setApplicationEntryPointUrl(newNavItem.id, newSrc, newAppId);
                                                } catch (err) {
                                                    if (window.console) {
                                                        window.console.error(err.message);
                                                    }
                                                }
                                            } else {
                                                AppHost.ApplicationHost.setApplicationEntryPointUrl(newNavItem.id, newSrc, newAppId);
                                            }
                                        }

                                        if (prevNavItem != newNavItem) {
                                            selectNavigationItem(newNavItem);
                                        }
                                    }
                                }
                                return;
                            }

                            if (newGroupId) {
                                var prevGroup = Navigation.currentNavigationGroup();
                                if (!prevGroup || prevGroup.id != newGroupId) {
                                    var group = getNavigationGroupById(newGroupId, newAppId);
                                    if (group && group.authenticationTargetDisplay && group.authenticationTargetDisplay()) {
                                        Navigation.currentNavigationGroup(group);
                                        selectNavigationItem(null);
                                    }
                                }
                                return;
                            }

                            if (Navigation.currentNavigationItem() != Navigation.homeNavigationItem) {
                                selectNavigationItem(Navigation.homeNavigationItem);
                            }
                        }
                        Navigation.setNavigationSelectionFromUrl = setNavigationSelectionFromUrl;

                        function initialize(callback) {
                            if (!initialized) {
                                if (callback) {
                                    initCallbacks.push(callback);
                                }

                                if (initialized === false) {
                                    initialized = undefined;

                                    AppHost.initialize(function () {
                                        initializeNavigationViewModel();
                                        initialized = true;
                                        for (var i = 0, len = initCallbacks.length; i < len; i++) {
                                            initCallbacks[i]();
                                        }
                                        initCallbacks = undefined;
                                    });
                                }
                            } else if (callback) {
                                callback();
                            }
                        }
                        Navigation.initialize = initialize;
                        ;

                        function getNavigationItemById(navigationItemId, applicationId) {
                            var allGroups = [Navigation.topNavigationGroup].concat(Navigation.navigationGroups);
                            for (var i = 0, len = allGroups.length; i < len; i++) {
                                var navigationItems = allGroups[i].navigationItems;
                                for (var j = 0, lenj = navigationItems.length; j < lenj; j++) {
                                    var item = navigationItems[j];
                                    if (item && (!navigationItemId || item.id == navigationItemId) && (!applicationId || item.applicationEntryPoint && item.applicationEntryPoint.application.id == applicationId)) {
                                        return item;
                                    }
                                }
                            }
                        }
                        Navigation.getNavigationItemById = getNavigationItemById;
                        ;

                        function onTopBarEvent(targetDisplay, e, topBar) {
                            AppHost.ApplicationHost.publishEvent("topbarevent", { type: e.type, data: e.data }, targetDisplay.targetDisplay);
                        }
                        Navigation.onTopBarEvent = onTopBarEvent;

                        function loadTargetDisplayForNavigationItem(navigationItem) {
                            if (!navigationItem.hidden()) {
                                var targetDisplay = navigationItem.targetDisplay;

                                if (targetDisplay) {
                                    var curNavigationItem = targetDisplay.navigationItem();
                                    if (curNavigationItem != navigationItem) {
                                        targetDisplay.navigationItem(navigationItem);
                                        if (!curNavigationItem) {
                                            navigationItem.targetDisplay.accessed(true);
                                        }
                                    }
                                }
                            }
                        }
                        ;

                        function initializeNavigationViewModel() {
                            var navigationNode = Client.Xml.selectSingleNode(Client.Configuration.ConfigurationManager.configuration, "//configuration/customSections/apphost:navigation");
                            if (navigationNode) {
                                // navigation is defined in configuration
                                var navigationGroupNodes = Client.Xml.selectNodes(navigationNode, "apphost:navigationGroup");
                                Navigation.navigationGroups = SDL.jQuery.map(navigationGroupNodes, function (navigationGroupNode, index) {
                                    var applicationEntryPointGroupId = navigationGroupNode.getAttribute("applicationEntryPointGroupId");
                                    if (applicationEntryPointGroupId) {
                                        return buildNavigationGroupForApplicationEntryPointGroup(getApplicationEntryPointGroupById(navigationGroupNode.getAttribute("applicationSuiteId"), applicationEntryPointGroupId), index == 0, navigationGroupNode);
                                    } else {
                                        return buildNavigationGroup(navigationGroupNode, index == 0);
                                    }
                                });
                            } else {
                                // navigation is built based on application host data
                                Navigation.navigationGroups = SDL.jQuery.map(AppHost.ApplicationHost.applications, function (application, index) {
                                    return SDL.jQuery.map(application.entryPointGroups, function (group, index) {
                                        return buildNavigationGroupForApplicationEntryPointGroup(group, index == 0);
                                    });
                                });
                            }

                            Navigation.authenticationTargetDisplays = SDL.jQuery.map(applicationAuthenticationTargetDisplays, function (display, index) {
                                return display;
                            });
                            Navigation.navigationItemTargetDisplays = SDL.jQuery.map(applicationNavigationItemTargetDisplaysIndex, function (displays, index) {
                                return SDL.jQuery.map(displays, function (display, index) {
                                    return display;
                                });
                            });

                            orderNavigationItems();
                            createTopNavigationGroup();

                            Navigation.currentNavigationItem.subscribe(function () {
                                var navItem = Navigation.currentNavigationItem();
                                if (navItem) {
                                    if (Navigation.currentNavigationGroup()) {
                                        Navigation.currentNavigationGroup(null);
                                    }

                                    if (navItem.contextual()) {
                                        navItem.contextual(false);
                                        if (!navItem.hidden()) {
                                            navItem.navigationGroup.shownItems(navItem.navigationGroup.shownItems() + 1);
                                        }
                                    }

                                    var authenticationTargetDisplay = navItem.navigationGroup && navItem.navigationGroup.authenticationTargetDisplay && navItem.navigationGroup.authenticationTargetDisplay();
                                    if (authenticationTargetDisplay) {
                                        if (authenticationTargetDisplay.navigationGroup() != navItem.navigationGroup) {
                                            authenticationTargetDisplay.navigationGroup(navItem.navigationGroup);
                                            authenticationTargetDisplay.accessed(true);
                                        }
                                    } else {
                                        loadTargetDisplayForNavigationItem(navItem);
                                    }

                                    if (!navItem.hidden()) {
                                        var appEntryPoint = navItem.applicationEntryPoint;
                                        AppHost.ApplicationHost.setActiveApplicationEntryPoint(appEntryPoint && appEntryPoint.id, appEntryPoint && appEntryPoint.application.id);
                                        return;
                                    }
                                }

                                AppHost.ApplicationHost.setActiveApplicationEntryPoint(null, null);
                            });

                            Navigation.currentNavigationGroup.subscribe(function () {
                                var navGroup = Navigation.currentNavigationGroup();
                                if (navGroup) {
                                    if (Navigation.currentNavigationItem()) {
                                        Navigation.currentNavigationItem(null);
                                    }

                                    var targetDisplay = navGroup.authenticationTargetDisplay && navGroup.authenticationTargetDisplay();
                                    if (targetDisplay && targetDisplay.navigationGroup() != navGroup) {
                                        targetDisplay.navigationGroup(navGroup);
                                        targetDisplay.accessed(true);
                                    }
                                }
                            });

                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationentrypointactivate", setActiveApplicationEntryPoint);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationentrypointurlchange", setApplicationEntryPointUrl);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationentrypointvisited", onApplicationEntryPointVisited);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationfacaderequest", loadApplicationEntryPoint);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationsuiteinitialize", initializeApplicationSuite);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "applicationsuitereset", resetApplicationSuite);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "targetdisplayload", onTargetDisplayLoaded);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "targetdisplayunload", onTargetDisplayUnloaded);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "targetdisplayurlchange", onTargetDisplayUrlChange);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "showtopbar", onTargetDisplayTopBarShow);
                            Client.Event.EventRegister.addEventHandler(AppHost.ApplicationHost, "settopbaroptions", onTargetDisplayTopBarOptions);

                            setNavigationSelectionFromUrl(true);

                            ko.computed(function setUrlFromNavigationSelection() {
                                var navItem = Navigation.currentNavigationItem();
                                var newHref = window.location.href;

                                if (navItem) {
                                    var appEntryPoint = navItem.applicationEntryPoint;

                                    if (appEntryPoint) {
                                        newHref = Url.setHashParameter(newHref, "app", appEntryPoint.application.id);
                                        newHref = Url.setHashParameter(newHref, "entry", navItem.id);
                                        newHref = Url.setHashParameter(newHref, "group", null);

                                        navItem.src(); // this is to trigger computed to recalculate when src() changes
                                        if (appEntryPoint.url && appEntryPoint.url != appEntryPoint.baseUrl) {
                                            newHref = Url.setHashParameter(newHref, "url", Url.makeRelativeUrl(appEntryPoint.baseUrl, appEntryPoint.url));
                                        } else {
                                            newHref = Url.setHashParameter(newHref, "url", null);
                                        }
                                    } else {
                                        newHref = Url.setHashParameter(newHref, "app", null);
                                        newHref = Url.setHashParameter(newHref, "entry", null);
                                        newHref = Url.setHashParameter(newHref, "group", null);
                                        newHref = Url.setHashParameter(newHref, "url", null);
                                    }
                                } else {
                                    newHref = Url.setHashParameter(newHref, "entry", null);

                                    var group = Navigation.currentNavigationGroup();
                                    if (group) {
                                        newHref = Url.setHashParameter(newHref, "app", group.applicationId);
                                        newHref = Url.setHashParameter(newHref, "group", group.id);
                                    } else {
                                        newHref = Url.setHashParameter(newHref, "app", null);
                                        newHref = Url.setHashParameter(newHref, "group", null);
                                    }
                                }

                                if (window.location.href != newHref) {
                                    if (newHref.indexOf("#") == -1) {
                                        newHref += "#"; // making sure there's a hash parameter, otherwise the whole window will refresh
                                    }
                                    window.location.href = newHref;
                                }
                            }).extend({ throttle: 1 });

                            SDL.jQuery(window).on("hashchange", function () {
                                setNavigationSelectionFromUrl();
                            });
                        }
                        ;

                        function getApplicationEntryPointGroupById(applicationId, applicationEntryPointGroupId) {
                            var application;
                            if (applicationId) {
                                application = AppHost.ApplicationHost.applicationsIndex[applicationId];
                                if (application) {
                                    return application.entryPointGroupsIndex[applicationEntryPointGroupId];
                                }
                            } else {
                                // application unspecified -> figure it out
                                var applications = AppHost.ApplicationHost.applications;
                                for (var i = 0, len = applications.length; i < len; i++) {
                                    var group = applications[i].entryPointGroupsIndex[applicationEntryPointGroupId];
                                    if (group) {
                                        return group;
                                    }
                                }
                            }
                        }
                        ;

                        function getApplicationEntryPointById(applicationId, applicationEntryPointId) {
                            var application;
                            if (applicationId) {
                                application = AppHost.ApplicationHost.applicationsIndex[applicationId];
                                return getApplicationEntryPointByIdInApplication(application, applicationEntryPointId);
                            } else {
                                // application unspecified -> figure it out
                                var applications = AppHost.ApplicationHost.applications;
                                for (var i = 0, len = applications.length; i < len; i++) {
                                    var entry = getApplicationEntryPointByIdInApplication(applications[i], applicationEntryPointId);
                                    if (entry) {
                                        return entry;
                                    }
                                }
                            }
                        }
                        ;

                        function getApplicationEntryPointByIdInApplication(application, applicationEntryPointId) {
                            for (var i = 0, len = application.entryPointGroups.length; i < len; i++) {
                                var group = application.entryPointGroups[i];
                                for (var j = 0, lenj = group.entryPoints.length; j < lenj; j++) {
                                    if (group.entryPoints[j].id == applicationEntryPointId) {
                                        return group.entryPoints[j];
                                    }
                                }
                            }
                        }
                        ;

                        function buildNavigationGroup(navigationGroupNode, isFirstGroup) {
                            var groupApplicationId = navigationGroupNode.getAttribute("applicationSuiteId");
                            var navigationItemNodes = Client.Xml.selectNodes(navigationGroupNode, "apphost:navigationItems/apphost:navigationItem[@applicationEntryPointId]");
                            var navigationGroup = {
                                id: navigationGroupNode.getAttribute("id"),
                                title: navigationGroupNode.getAttribute("title"),
                                applicationEntryPointGroup: null,
                                navigationItems: null,
                                applications: [],
                                translations: buildNameTranslations(navigationGroupNode),
                                shownItems: null,
                                applicationId: groupApplicationId
                            };

                            if (groupApplicationId) {
                                var application = AppHost.ApplicationHost.applicationsIndex[groupApplicationId];
                                if (application) {
                                    navigationGroup.applications.push(application);
                                }
                            }

                            var shownItems = 0;
                            navigationGroup.navigationItems = SDL.jQuery.map(navigationItemNodes, function (navigationItemNode, index) {
                                var applicationEntryPoint = getApplicationEntryPointById(navigationItemNode.getAttribute("applicationSuiteId") || groupApplicationId, navigationItemNode.getAttribute("applicationEntryPointId"));

                                if (applicationEntryPoint) {
                                    var application = applicationEntryPoint && applicationEntryPoint.application;
                                    if (navigationGroup.applications.indexOf(application) == -1) {
                                        navigationGroup.applications.push(application);
                                    }

                                    if (application.authenticationUrl && !application.authenticated && !navigationGroup.authenticationTargetDisplay) {
                                        navigationGroup.authenticationTargetDisplay = ko.observable(getAuthenticationTargetDisplay(application));
                                    }

                                    var navigationItem = buildNavigationItemForApplicationEntryPoint(applicationEntryPoint, navigationGroup, isFirstGroup, navigationItemNode);
                                    if (topNavigationGroupItems.indexOf(navigationItem) == -1) {
                                        if (!navigationItem.contextual() && !navigationItem.hidden()) {
                                            shownItems++;
                                        }
                                        return navigationItem;
                                    }
                                }
                            });

                            navigationGroup.shownItems = ko.observable(shownItems);
                            return navigationGroup;
                        }
                        ;

                        function buildNavigationGroupForApplicationEntryPointGroup(applicationEntryPointGroup, isFirstGroup, navigationGroupNode) {
                            var application = applicationEntryPointGroup.application;
                            var navigationGroup = {
                                id: navigationGroupNode && navigationGroupNode.getAttribute("id") || applicationEntryPointGroup.id,
                                title: navigationGroupNode && navigationGroupNode.getAttribute("title") || applicationEntryPointGroup.title,
                                applicationEntryPointGroup: applicationEntryPointGroup,
                                navigationItems: null,
                                applications: [application],
                                shownItems: null,
                                applicationId: application.id
                            };

                            var shownItems = 0;
                            navigationGroup.navigationItems = SDL.jQuery.map(applicationEntryPointGroup.entryPoints, function (entryPoint, index) {
                                var navigationItem = buildNavigationItemForApplicationEntryPoint(entryPoint, navigationGroup, isFirstGroup);
                                if (topNavigationGroupItems.indexOf(navigationItem) == -1) {
                                    if (!navigationItem.contextual() && !navigationItem.hidden()) {
                                        shownItems++;
                                    }
                                    return navigationItem;
                                }
                            });

                            navigationGroup.shownItems = ko.observable(shownItems);

                            if (application.authenticationUrl && !application.authenticated) {
                                navigationGroup.authenticationTargetDisplay = ko.observable(getAuthenticationTargetDisplay(application));
                            }

                            if (navigationGroupNode) {
                                navigationGroup.translations = buildNameTranslations(navigationGroupNode);
                            }

                            return navigationGroup;
                        }
                        ;

                        function getAuthenticationTargetDisplay(application) {
                            var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[application.id];
                            if (!authenticationTargetDisplay) {
                                authenticationTargetDisplay = applicationAuthenticationTargetDisplays[application.id] = {
                                    targetDisplay: application.authenticationTargetDisplay,
                                    navigationGroup: ko.observable(null),
                                    src: application.authenticationUrl,
                                    loaded: ko.observable(false),
                                    loading: null,
                                    topBarShown: ko.observable(false),
                                    topBarOptions: ko.observable(SDL.jQuery.extend({}, baseTopBarOptions)),
                                    timeout: 0,
                                    authenticationMode: application.authenticationMode,
                                    accessed: ko.observable(application.authenticationMode != "on-access"),
                                    authenticated: false,
                                    disposed: ko.observable(false)
                                };

                                authenticationTargetDisplay.loading = ko.computed(isTargetDisplayLoading, authenticationTargetDisplay);
                            }

                            return authenticationTargetDisplay;
                        }
                        ;

                        function buildNavigationItemForApplicationEntryPoint(applicationEntryPoint, parentNavigationGroup, isFirstGroup, navigationItemNode) {
                            var navigationItem = {
                                id: applicationEntryPoint.id,
                                type: navigationItemNode && navigationItemNode.getAttribute("type") || applicationEntryPoint.type,
                                title: navigationItemNode && navigationItemNode.getAttribute("title") || applicationEntryPoint.title,
                                applicationEntryPoint: applicationEntryPoint,
                                src: ko.observable(Url.isAbsoluteUrl(applicationEntryPoint.url) ? applicationEntryPoint.url : "about:blank"),
                                icon: applicationEntryPoint.icon,
                                topIcon: applicationEntryPoint.topIcon,
                                navigationGroup: parentNavigationGroup,
                                targetDisplay: buildNavigationItemTargetDisplay(applicationEntryPoint.targetDisplay.name, applicationEntryPoint.application),
                                contextual: ko.observable(applicationEntryPoint.contextual && !applicationEntryPoint.visited),
                                hidden: ko.observable(applicationEntryPoint.hidden),
                                external: applicationEntryPoint.external,
                                overlay: applicationEntryPoint.overlay
                            };

                            if (isFirstGroup) {
                                switch (navigationItem.type) {
                                    case "home":
                                        if (!Navigation.homeNavigationItem) {
                                            Navigation.homeNavigationItem = navigationItem;
                                            topNavigationGroupItems.unshift(navigationItem);
                                        }
                                        break;
                                    case "top":
                                        // add to the top group
                                        topNavigationGroupItems.push(navigationItem);
                                        break;
                                }
                            }

                            if (!navigationItemsIndex[applicationEntryPoint.application.id]) {
                                navigationItemsIndex[applicationEntryPoint.application.id] = [navigationItem];
                            } else {
                                navigationItemsIndex[applicationEntryPoint.application.id].push(navigationItem);
                            }

                            if (navigationItemNode) {
                                navigationItem.titleResource = navigationItemNode.getAttribute("titleResource");
                                navigationItem.translations = buildNameTranslations(navigationItemNode);

                                var icon = navigationItemNode.getAttribute("icon");
                                var topIcon = navigationItemNode.getAttribute("topIcon");
                                var isIconRelative = icon && icon.charAt(0) != "/" && icon.indexOf("~/") == -1;
                                var isTopIconRelative = topIcon && topIcon.charAt(0) != "/" && topIcon.indexOf("~/") == -1;
                                if (isIconRelative || isTopIconRelative) {
                                    var baseUrlNodes = Client.Xml.selectNodes(navigationItemNode, "ancestor::configuration/@baseUrl");
                                    var baseUrl = baseUrlNodes.length ? baseUrlNodes[baseUrlNodes.length - 1].value : "";

                                    if (isIconRelative) {
                                        icon = Url.combinePath(baseUrl, icon);
                                    }

                                    if (isTopIconRelative) {
                                        topIcon = Url.combinePath(baseUrl, topIcon);
                                    }
                                }

                                if (icon) {
                                    if (icon.indexOf("~/") == 0) {
                                        icon = Url.combinePath(Client.Configuration.ConfigurationManager.corePath, icon.slice(2));
                                    }
                                    navigationItem.icon = icon;
                                }

                                if (topIcon) {
                                    if (topIcon.indexOf("~/") == 0) {
                                        topIcon = Url.combinePath(Client.Configuration.ConfigurationManager.corePath, topIcon.slice(2));
                                    }
                                    navigationItem.topIcon = topIcon;
                                }

                                var external = navigationItemNode.getAttribute("external");
                                if (external) {
                                    navigationItem.external = external == "true" || external == "1";
                                }
                                if (!applicationEntryPoint.visited) {
                                    var contextual = navigationItemNode.getAttribute("contextual");
                                    if (contextual) {
                                        navigationItem.contextual(contextual == "true" || contextual == "1");
                                    }
                                }
                                var overlay = navigationItemNode.getAttribute("overlay");
                                if (overlay) {
                                    navigationItem.overlay = !(overlay == "false" || overlay == "0") && (overlay == "true" || overlay == "1" || undefined);
                                }
                            }

                            return navigationItem;
                        }
                        ;

                        function buildNavigationItemTargetDisplay(targetDisplayName, application) {
                            if (targetDisplayName) {
                                var navigationItemTargetDisplays = applicationNavigationItemTargetDisplaysIndex[application.id];
                                if (!navigationItemTargetDisplays) {
                                    navigationItemTargetDisplays = applicationNavigationItemTargetDisplaysIndex[application.id] = {};
                                }
                                var targetDisplay = navigationItemTargetDisplays[targetDisplayName];
                                if (!targetDisplay) {
                                    var applicationEntryPointTargetDisplay = application.targetDisplaysIndex[targetDisplayName];
                                    if (applicationEntryPointTargetDisplay) {
                                        targetDisplay = navigationItemTargetDisplays[targetDisplayName] = {
                                            targetDisplay: applicationEntryPointTargetDisplay,
                                            src: null,
                                            accessed: ko.observable(false),
                                            loaded: ko.observable(false),
                                            loading: null,
                                            topBarShown: ko.observable(false),
                                            topBarOptions: ko.observable(SDL.jQuery.extend({}, baseTopBarOptions)),
                                            timeout: 0,
                                            disposed: ko.observable(false),
                                            navigationItem: ko.observable(null)
                                        };

                                        targetDisplay.loading = ko.computed(isTargetDisplayLoading, targetDisplay);
                                    }
                                }
                                return targetDisplay;
                            }
                        }
                        ;

                        function isTargetDisplayLoading() {
                            var targetDisplay = this;
                            if (targetDisplay.accessed() && !targetDisplay.loaded()) {
                                if (targetDisplay.timeout) {
                                    window.clearTimeout(targetDisplay.timeout);
                                }

                                targetDisplay.timeout = window.setTimeout(function () {
                                    targetDisplay.timeout = 0;
                                    if (window.console) {
                                        window.console.warn(targetDisplay.src + " failed to load within 10 seconds");
                                    }
                                    targetDisplay.loaded(true);
                                }, 10000);

                                return true;
                            } else {
                                if (targetDisplay.timeout) {
                                    window.clearTimeout(targetDisplay.timeout);
                                    targetDisplay.timeout = 0;
                                }
                                return false;
                            }
                        }
                        ;

                        function getNavigationGroupById(groupId, applicationId) {
                            for (var i = 0, len = Navigation.navigationGroups.length; i < len; i++) {
                                var group = Navigation.navigationGroups[i];
                                if (group.id == groupId && applicationId == group.applicationId) {
                                    return Navigation.navigationGroups[i];
                                }
                            }
                        }
                        ;

                        function buildNameTranslations(parent) {
                            var translations = {};
                            var translationNodes = Client.Xml.selectNodes(parent, "apphost:translations/apphost:title[@lang]");
                            for (var i = 0, len = translationNodes.length; i < len; i++) {
                                var translationNode = translationNodes[i];
                                translations[translationNode.getAttribute("lang")] = Client.Xml.getInnerText(translationNode);
                            }
                            return translations;
                        }
                        ;

                        function orderNavigationItems() {
                            SDL.jQuery.each(Navigation.navigationGroups, function (index, group) {
                                var home = [];
                                var activities = [];
                                var rest = [];
                                var settings = [];
                                var help = [];
                                var about = [];

                                var items = group.navigationItems;
                                for (var i = 0, len = items.length; i < len; i++) {
                                    var item = items[i];
                                    switch (item.type) {
                                        case "home":
                                            home.push(item);
                                            break;
                                        case "activities":
                                            activities.push(item);
                                            break;
                                        case "settings":
                                            settings.push(item);
                                            break;
                                        case "help":
                                            help.push(item);
                                            break;
                                        case "about":
                                            about.push(item);
                                            break;
                                        default:
                                            rest.push(item);
                                            break;
                                    }
                                }
                                group.navigationItems = home.concat(activities, rest, settings, help, about);
                            });
                        }
                        ;

                        function createTopNavigationGroup() {
                            Navigation.topNavigationGroup = {
                                id: null,
                                title: null,
                                applicationEntryPointGroup: null,
                                navigationItems: topNavigationGroupItems,
                                applications: [],
                                shownItems: ko.observable(topNavigationGroupItems.length + (Navigation.homeNavigationItem ? 0 : 1))
                            };

                            for (var i = 0; i < topNavigationGroupItems.length; i++) {
                                var topNavigationGroupItem = topNavigationGroupItems[i];
                                application = topNavigationGroupItem.applicationEntryPoint.application;
                                topNavigationGroupItem.navigationGroup = Navigation.topNavigationGroup;

                                if (Navigation.topNavigationGroup.applications.indexOf(application) == -1) {
                                    Navigation.topNavigationGroup.applications.push(application);
                                }

                                if (!Navigation.topNavigationGroup.applicationId) {
                                    Navigation.topNavigationGroup.applicationId = application.id;
                                }

                                if (application.authenticationUrl && !application.authenticated && !Navigation.topNavigationGroup.authenticationTargetDisplay) {
                                    Navigation.topNavigationGroup.authenticationTargetDisplay = ko.observable(getAuthenticationTargetDisplay(application));
                                }
                            }

                            if (!Navigation.homeNavigationItem) {
                                Navigation.homeNavigationItem = {
                                    id: null,
                                    type: "home",
                                    src: ko.observable("about:blank"),
                                    navigationGroup: Navigation.topNavigationGroup,
                                    targetDisplay: null,
                                    contextual: ko.observable(false),
                                    hidden: ko.observable(false)
                                };

                                if (!Navigation.topNavigationGroup.applicationId && Navigation.navigationGroups.length) {
                                    var firstGroup = Navigation.navigationGroups[0];
                                    var application = firstGroup.applications.length == 1 ? firstGroup.applications[0] : (firstGroup.applicationId ? AppHost.ApplicationHost.applicationsIndex[firstGroup.applicationId] : null);

                                    if (application) {
                                        Navigation.topNavigationGroup.applicationId = application.id;
                                        Navigation.topNavigationGroup.applications.push(application);
                                        if (application.authenticationUrl && !application.authenticated) {
                                            Navigation.topNavigationGroup.authenticationTargetDisplay = ko.observable(getAuthenticationTargetDisplay(application));
                                        }
                                    }
                                }
                                topNavigationGroupItems.unshift(Navigation.homeNavigationItem);
                            }
                        }
                        ;

                        function setActiveApplicationEntryPoint(event) {
                            var applicationEntryPointId = event.data.applicationEntryPointId;
                            if (applicationEntryPointId) {
                                var applicationId = event.data.applicationId;
                                var navigationItem = Navigation.currentNavigationItem();
                                if (!navigationItem || navigationItem.id != applicationEntryPointId || (navigationItem.applicationEntryPoint && navigationItem.applicationEntryPoint.application.id) != applicationId) {
                                    navigationItem = getNavigationItemById(applicationEntryPointId, applicationId);
                                    if (navigationItem && !navigationItem.hidden()) {
                                        selectNavigationItem(navigationItem);
                                    }
                                }
                            }
                        }
                        ;

                        function onApplicationEntryPointVisited(event) {
                            var applicationEntryPointId = event.data.applicationEntryPointId;
                            var url = event.data.url;
                            SDL.jQuery.each(navigationItemsIndex[event.data.applicationId] || [], function (index, item) {
                                if (item.id == applicationEntryPointId && item.contextual()) {
                                    item.contextual(false);
                                    if (!item.hidden()) {
                                        item.navigationGroup.shownItems(item.navigationGroup.shownItems() + 1);
                                    }
                                }
                            });
                        }
                        ;

                        function setApplicationEntryPointUrl(event) {
                            var url = event.data.url;
                            if (Url.isAbsoluteUrl(url)) {
                                var applicationEntryPointId = event.data.applicationEntryPointId;
                                SDL.jQuery.each(navigationItemsIndex[event.data.applicationId] || [], function (index, item) {
                                    if (item.id == applicationEntryPointId && item.src() != url) {
                                        item.src(url);
                                    }
                                });
                            }
                        }
                        ;

                        function loadApplicationEntryPoint(event) {
                            var applicationId = event.data.applicationId;
                            var items = navigationItemsIndex[applicationId];
                            if (items) {
                                var itemToAuthenticate;
                                var applicationEntryPointId = event.data.applicationEntryPointId;
                                for (var i = 0, len = items.length; i < len; i++) {
                                    var navigationItem = items[i];
                                    if (navigationItem.id == applicationEntryPointId) {
                                        if (!navigationItem.navigationGroup.authenticationTargetDisplay || !navigationItem.navigationGroup.authenticationTargetDisplay()) {
                                            loadTargetDisplayForNavigationItem(navigationItem);
                                            return;
                                        } else if (!itemToAuthenticate) {
                                            itemToAuthenticate = navigationItem;
                                        }
                                    }
                                }
                                if (itemToAuthenticate) {
                                    selectNavigationItem(itemToAuthenticate);
                                }
                            }
                        }
                        ;

                        function initializeApplicationSuite(event) {
                            var applicationId = event.data.applicationId;

                            var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[applicationId];
                            if (authenticationTargetDisplay && !authenticationTargetDisplay.authenticated) {
                                var includeApplicationEntryPointIds = event.data.includeApplicationEntryPointIds;
                                var excludeApplicationEntryPointIds = event.data.excludeApplicationEntryPointIds;
                                var selectedGroup = Navigation.currentNavigationGroup();
                                var selectedItem = Navigation.currentNavigationItem();
                                var application = AppHost.ApplicationHost.applicationsIndex[applicationId];

                                applicationAuthenticationTargetDisplays[applicationId].authenticated = true;

                                SDL.jQuery.each([Navigation.topNavigationGroup].concat(Navigation.navigationGroups), function (index, navigationGroup) {
                                    if (navigationGroup.authenticationTargetDisplay && navigationGroup.applications.indexOf(application) != -1) {
                                        var selectGroup = false;
                                        if (includeApplicationEntryPointIds || excludeApplicationEntryPointIds) {
                                            var shownItems = navigationGroup.shownItems();
                                            SDL.jQuery.each(navigationGroup.navigationItems, function (index, navigationItem) {
                                                var appEntryPoint = navigationItem.applicationEntryPoint;
                                                if (appEntryPoint && appEntryPoint.application == application && appEntryPoint.hidden) {
                                                    navigationItem.hidden(true);

                                                    if (navigationGroup != Navigation.topNavigationGroup) {
                                                        if (!navigationItem.contextual()) {
                                                            shownItems--;
                                                        }

                                                        if (selectedItem == navigationItem) {
                                                            selectGroup = true;
                                                        }
                                                    }
                                                }
                                            });

                                            if (shownItems != navigationGroup.shownItems()) {
                                                navigationGroup.shownItems(shownItems);
                                            }
                                        }

                                        var newAuthTargetDisplay;
                                        if (navigationGroup.authenticationTargetDisplay() == authenticationTargetDisplay) {
                                            for (var i = 0, len = navigationGroup.applications.length; i < len; i++) {
                                                var nextAuthTargetDisplay = applicationAuthenticationTargetDisplays[navigationGroup.applications[i].id];
                                                if (nextAuthTargetDisplay && !nextAuthTargetDisplay.authenticated && (!newAuthTargetDisplay || nextAuthTargetDisplay.authenticationMode != "on-access")) {
                                                    newAuthTargetDisplay = nextAuthTargetDisplay;
                                                    if (newAuthTargetDisplay.authenticationMode != "on-access") {
                                                        break;
                                                    }
                                                }
                                            }
                                        }

                                        if (newAuthTargetDisplay) {
                                            if (selectGroup) {
                                                Navigation.currentNavigationGroup(navigationGroup);
                                                Navigation.currentNavigationItem(null);
                                            }
                                            navigationGroup.authenticationTargetDisplay(newAuthTargetDisplay);

                                            if (selectGroup || selectedGroup == navigationGroup || (selectedItem && selectedItem.navigationGroup == navigationGroup)) {
                                                newAuthTargetDisplay.navigationGroup(navigationGroup);
                                                newAuthTargetDisplay.accessed(true);
                                            } else if (newAuthTargetDisplay.authenticationMode != "on-access") {
                                                newAuthTargetDisplay.accessed(true);
                                            }
                                        } else {
                                            if (selectGroup || selectedGroup == navigationGroup) {
                                                var firstNavigationItem;
                                                for (var i = 0, len = navigationGroup.navigationItems.length; !firstNavigationItem && i < len; i++) {
                                                    firstNavigationItem = navigationGroup.navigationItems[i];
                                                    if (firstNavigationItem.external || firstNavigationItem.hidden()) {
                                                        firstNavigationItem = null;
                                                    }
                                                }
                                                selectedItem = firstNavigationItem || Navigation.homeNavigationItem;
                                                Navigation.currentNavigationItem(selectedItem);
                                                loadTargetDisplayForNavigationItem(selectedItem);
                                            } else if (selectedItem && selectedItem.navigationGroup == navigationGroup) {
                                                loadTargetDisplayForNavigationItem(selectedItem);
                                            }
                                            navigationGroup.authenticationTargetDisplay(null);
                                        }
                                    }
                                });

                                if (authenticationTargetDisplay.targetDisplay && authenticationTargetDisplay.targetDisplay.frame) {
                                    authenticationTargetDisplay.targetDisplay.frame.src = "about:blank";
                                }
                            }
                        }
                        ;

                        function resetApplicationSuite(event) {
                            var applicationId = event.data.applicationId;

                            var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[applicationId];
                            if (authenticationTargetDisplay && authenticationTargetDisplay.authenticated) {
                                var application = authenticationTargetDisplay.targetDisplay.application;

                                authenticationTargetDisplay.authenticated = false;
                                authenticationTargetDisplay.navigationGroup(null);
                                authenticationTargetDisplay.accessed(false);
                                authenticationTargetDisplay.disposed(false);
                                authenticationTargetDisplay.loaded(false);

                                var selectedNavigationGroup = Navigation.currentNavigationGroup();
                                var selectedNavigationItem = Navigation.currentNavigationItem();
                                var activeNavigationGroup = null;

                                SDL.jQuery.each(Navigation.navigationGroups.concat(Navigation.topNavigationGroup), function (index, navigationGroup) {
                                    if (navigationGroup.authenticationTargetDisplay && navigationGroup.applications.indexOf(application) != -1) {
                                        if (!navigationGroup.authenticationTargetDisplay()) {
                                            navigationGroup.authenticationTargetDisplay(authenticationTargetDisplay);
                                        }

                                        if (navigationGroup == selectedNavigationGroup) {
                                            activeNavigationGroup = navigationGroup;
                                        }

                                        var shownItems = navigationGroup.shownItems();

                                        SDL.jQuery.each(navigationGroup.navigationItems, function (index, navigationItem) {
                                            var appEntryPoint = navigationItem.applicationEntryPoint;
                                            if (appEntryPoint && appEntryPoint.application == application) {
                                                if (navigationItem.hidden()) {
                                                    if (navigationGroup != Navigation.topNavigationGroup && !navigationItem.contextual()) {
                                                        shownItems++;
                                                    }
                                                    navigationItem.hidden(false);
                                                }

                                                if (navigationItem.targetDisplay.navigationItem() == navigationItem) {
                                                    navigationItem.targetDisplay.navigationItem(null);
                                                }

                                                if (navigationItem == selectedNavigationItem) {
                                                    activeNavigationGroup = navigationGroup;
                                                }
                                            }
                                        });

                                        if (navigationGroup != Navigation.topNavigationGroup && navigationGroup.shownItems() != shownItems) {
                                            navigationGroup.shownItems(shownItems);
                                        }
                                    }
                                });

                                if (activeNavigationGroup && activeNavigationGroup.authenticationTargetDisplay() == authenticationTargetDisplay) {
                                    authenticationTargetDisplay.navigationGroup(activeNavigationGroup);
                                    authenticationTargetDisplay.accessed(true);
                                } else if (authenticationTargetDisplay.authenticationMode != "on-access") {
                                    authenticationTargetDisplay.accessed(true);
                                }
                            }
                        }
                        ;

                        function onTargetDisplayLoaded(event) {
                            var targetDisplay = event.data.targetDisplay;
                            var application = targetDisplay.application;
                            if (application && targetDisplay.name) {
                                var applicationTargetDisplays = applicationNavigationItemTargetDisplaysIndex[application.id];
                                if (applicationTargetDisplays) {
                                    var navigationItemTargetDisplay = applicationTargetDisplays[targetDisplay.name];
                                    if (navigationItemTargetDisplay) {
                                        navigationItemTargetDisplay.loaded(true);
                                    }
                                }
                            }
                        }
                        ;

                        function onTargetDisplayUnloaded(event) {
                            var targetDisplay = event.data.targetDisplay;
                            var application = targetDisplay.application;
                            if (application) {
                                var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[application.id];
                                if (authenticationTargetDisplay && authenticationTargetDisplay.targetDisplay == targetDisplay) {
                                    if (authenticationTargetDisplay.authenticated && !authenticationTargetDisplay.disposed()) {
                                        authenticationTargetDisplay.targetDisplay.frame = null;
                                        setTimeout(function () {
                                            return authenticationTargetDisplay.disposed(true);
                                        }, 1); // Chrome crashes without the timeout
                                    }
                                } else if (targetDisplay.name) {
                                    var navigationItemTargetDisplay = applicationNavigationItemTargetDisplaysIndex[application.id][targetDisplay.name];
                                    if (navigationItemTargetDisplay) {
                                        navigationItemTargetDisplay.loaded(false);
                                        navigationItemTargetDisplay.topBarShown(false);
                                    }
                                }
                            }
                        }
                        ;

                        function onTargetDisplayUrlChange(event) {
                            var targetDisplay = event.data.targetDisplay;
                            var application = targetDisplay.application;
                            if (application && targetDisplay.name) {
                                var navigationItemTargetDisplay = applicationNavigationItemTargetDisplaysIndex[application.id][targetDisplay.name];
                                if (navigationItemTargetDisplay) {
                                    navigationItemTargetDisplay.src = targetDisplay.loadedUrl; // must be the same as event.data.url
                                }
                            }
                        }
                        ;

                        function onTargetDisplayTopBarShow(event) {
                            var targetDisplay = event.data.targetDisplay;
                            var application = targetDisplay.application;
                            if (application) {
                                var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[application.id];
                                if (authenticationTargetDisplay && authenticationTargetDisplay.targetDisplay == targetDisplay) {
                                    authenticationTargetDisplay.topBarShown(true);
                                } else if (targetDisplay.name) {
                                    var navigationItemTargetDisplay = applicationNavigationItemTargetDisplaysIndex[application.id][targetDisplay.name];
                                    if (navigationItemTargetDisplay) {
                                        navigationItemTargetDisplay.topBarShown(true);
                                    }
                                }
                            }
                        }

                        function onTargetDisplayTopBarOptions(event) {
                            var options = event.data.options;
                            var targetDisplay = event.data.targetDisplay;
                            var application = targetDisplay.application;
                            if (application) {
                                var authenticationTargetDisplay = applicationAuthenticationTargetDisplays[application.id];
                                if (authenticationTargetDisplay && authenticationTargetDisplay.targetDisplay == targetDisplay) {
                                    authenticationTargetDisplay.topBarOptions(SDL.jQuery.extend({}, baseTopBarOptions, options));
                                } else if (targetDisplay.name) {
                                    var navigationItemTargetDisplay = applicationNavigationItemTargetDisplaysIndex[application.id][targetDisplay.name];
                                    if (navigationItemTargetDisplay) {
                                        navigationItemTargetDisplay.topBarOptions(SDL.jQuery.extend({}, baseTopBarOptions, options));
                                    }
                                }
                            }
                        }

                        initialize();
                    })(ViewModels.Navigation || (ViewModels.Navigation = {}));
                    var Navigation = ViewModels.Navigation;
                })(ApplicationHost.ViewModels || (ApplicationHost.ViewModels = {}));
                var ViewModels = ApplicationHost.ViewModels;
            })(UI.ApplicationHost || (UI.ApplicationHost = {}));
            var ApplicationHost = UI.ApplicationHost;
        })(Client.UI || (Client.UI = {}));
        var UI = Client.UI;
    })(SDL.Client || (SDL.Client = {}));
    var Client = SDL.Client;
})(SDL || (SDL = {}));
//# sourceMappingURL=Navigation.js.map
/// <reference path="../../ViewModels/Navigation.ts" />
/// <reference path="../../../../../SDL.Client/SDL.Client.Core/Types/Object.d.ts" />
/// <reference path="../../../../../SDL.Client/SDL.Client.UI.Core/Views/ViewBase.d.ts" />
/// <reference path="../../../../../SDL.Client/SDL.Client.UI.Core.Knockout/ViewModels/ViewModelBase.d.ts" />
var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var SDL;
(function (SDL) {
    (function (Client) {
        (function (UI) {
            (function (ApplicationHost) {
                (function (Views) {
                    var Navigation = SDL.Client.UI.ApplicationHost.ViewModels.Navigation;

                    eval(SDL.Client.Types.OO.enableCustomInheritance);
                    var Frame = (function (_super) {
                        __extends(Frame, _super);
                        function Frame() {
                            _super.apply(this, arguments);
                            this.initialized = ko.observable(false);
                        }
                        Frame.prototype.getRenderOptions = function () {
                            var _this = this;
                            var model = this.model = new SDL.UI.Core.Knockout.ViewModels.ViewModelBase();

                            model.initialized = this.initialized;
                            model.visitedNavigationGroups = ko.observableArray([]);
                            model.toggleNavigationPane = function () {
                                model.navigationPaneShown(!model.navigationPaneShown());
                            };

                            model.selectNavigationItem = function (item) {
                                Navigation.selectNavigationItem(item);
                            };

                            model.selectNavigationGroup = function (group) {
                                Navigation.currentNavigationGroup(group);
                            };

                            model.toggleExpandNavigationGroup = function (group) {
                                if (model.expandedNavigationGroup() != group) {
                                    model.expandedNavigationGroup(group);
                                } else {
                                    var groupsCount = 0;
                                    for (var i = 0, len = model.navigationGroups.length; i < len; i++) {
                                        var group = model.navigationGroups[i];
                                        if (group.shownItems()) {
                                            if (groupsCount) {
                                                model.expandedNavigationGroup(null); // more than 1 groups have items -> can collapse
                                                return;
                                            }
                                            groupsCount++;
                                        }
                                    }
                                }
                            };

                            model.blurredNavigationPane = function () {
                                if (model.navigationPaneShown()) {
                                    var currentNavigationItem = Navigation.currentNavigationItem();
                                    if (currentNavigationItem ? (currentNavigationItem.type != "home" || currentNavigationItem.navigationGroup.authenticationTargetDisplay && currentNavigationItem.navigationGroup.authenticationTargetDisplay()) : Navigation.currentNavigationGroup() != null) {
                                        model.navigationPaneShown(false);
                                    }
                                }
                            };

                            model.setTargetDisplayLocation = function (targetDisplay, node) {
                                if (targetDisplay.navigationItem) {
                                    var item = targetDisplay.navigationItem();
                                    var src = (!item || item.hidden()) ? "about:blank" : item.src();
                                    if (targetDisplay.src != src) {
                                        var frame = SDL.jQuery(node).prev("div").find("iframe")[0];
                                        if (src != "about:blank") {
                                            var urlChange = Client.Types.Url.makeRelativeUrl(targetDisplay.src, src);
                                            if (urlChange && urlChange.charAt(0) != "#") {
                                                // change is more than just a hash
                                                targetDisplay.loaded(false);
                                            }
                                        }

                                        try  {
                                            frame.contentWindow.location.replace(src);
                                        } catch (err) {
                                            frame.src = src;
                                        }

                                        targetDisplay.src = src;
                                    }
                                }
                            };

                            var getTranslation = function (translations, fallbackTranslations) {
                                if (translations || fallbackTranslations) {
                                    var culture = model.culture();
                                    if (culture) {
                                        if (translations && translations[culture]) {
                                            return translations[culture];
                                        }
                                        if (fallbackTranslations && fallbackTranslations[culture]) {
                                            return fallbackTranslations[culture];
                                        }

                                        if (culture.indexOf("-") != -1) {
                                            culture = culture.replace(/\-.*$/, "");
                                            if (translations && translations[culture]) {
                                                return translations[culture];
                                            }
                                            if (fallbackTranslations && fallbackTranslations[culture]) {
                                                return fallbackTranslations[culture];
                                            }
                                        }
                                    }
                                }
                            };

                            model.getNavigationItemName = function (item) {
                                if (item == Navigation.homeNavigationItem) {
                                    return model.localize("apphost.home");
                                } else {
                                    var name = getTranslation(item.translations, item.applicationEntryPoint && item.applicationEntryPoint.translations) || (item.titleResource && model.localize(item.titleResource)) || item.title;
                                    if (name) {
                                        return name;
                                    }

                                    switch (item.type) {
                                        case "home":
                                            return model.localize("apphost.home");
                                        case "activities":
                                            return model.localize("apphost.activities");
                                        case "settings":
                                            return model.localize("apphost.settings");
                                        case "help":
                                            return model.localize("apphost.help");
                                        case "about":
                                            return model.localize("apphost.about");
                                        default:
                                            return item.id;
                                    }
                                }
                            };

                            model.getNavigationGroupName = function (group) {
                                return getTranslation(group.translations, group.applicationEntryPointGroup && group.applicationEntryPointGroup.translations) || group.title || group.id;
                            };

                            model.registerTargetDisplayFrame = function (targetDisplay, frame) {
                                targetDisplay.targetDisplay.frame = frame;
                            };

                            Navigation.initialize(function () {
                                var currentItem = Navigation.currentNavigationItem();
                                model.navigationPaneShown = ko.observable(currentItem ? (currentItem.type == "home" && !currentItem.navigationGroup.authenticationTargetDisplay) : !Navigation.currentNavigationGroup());
                                model.navigationGroups = Navigation.navigationGroups;
                                model.currentNavigationItem = Navigation.currentNavigationItem;
                                model.currentNavigationGroup = Navigation.currentNavigationGroup;
                                model.navigationItemTargetDisplays = Navigation.navigationItemTargetDisplays;
                                model.authenticationTargetDisplays = Navigation.authenticationTargetDisplays;
                                model.topNavigationGroup = Navigation.topNavigationGroup;
                                model.homeNavigationItem = Navigation.homeNavigationItem;

                                model.navigationPaneToggleShown = ko.computed(function () {
                                    var currentGroup;
                                    var currentItem = model.currentNavigationItem();
                                    if (currentItem) {
                                        currentGroup = currentItem.navigationGroup;
                                    } else {
                                        currentGroup = model.currentNavigationGroup();
                                    }

                                    if (currentGroup && currentGroup.authenticationTargetDisplay) {
                                        var authTargetDisplay = currentGroup.authenticationTargetDisplay();
                                        if (authTargetDisplay) {
                                            var applicationToAuthenticate = authTargetDisplay.targetDisplay.application;
                                            var visitedNavigationGroups = model.visitedNavigationGroups();
                                            for (var i = 0, len = visitedNavigationGroups.length; i < len; i++) {
                                                var group = visitedNavigationGroups[i];
                                                if (group != currentGroup && (!group.authenticationTargetDisplay || !group.authenticationTargetDisplay() || SDL.jQuery.inArray(applicationToAuthenticate, group.applications) == -1)) {
                                                    // a group exists that is not blocked by current app's authentication screen
                                                    return true;
                                                }
                                            }

                                            // there are no other navigation groups that have been accesssed -> hide the toggle button
                                            return false;
                                        }
                                    }
                                    return true;
                                });

                                model.isTargetDisplayOut = function (targetDisplay) {
                                    var navItem = targetDisplay.navigationItem && targetDisplay.navigationItem();
                                    return navItem && (navItem.overlay === false || (navItem.type == 'home' && !navItem.overlay)) && model.navigationPaneShown();
                                };

                                model.isTargetDisplaySlideAnimated = function (targetDisplay, element) {
                                    if (model.navigationPaneShown() && !model.isTargetDisplayOut(targetDisplay)) {
                                        return false;
                                    } else if (!SDL.jQuery(element).hasClass("frame-application-animated")) {
                                        // enable animation with a delay to prevent animation when the display becomes active when navigation pane is already shown
                                        setTimeout(function () {
                                            SDL.jQuery(element).addClass("frame-application-animated");
                                        }, 10);
                                        return false;
                                    } else {
                                        // keep animation enabled
                                        return true;
                                    }
                                };

                                model.expandedNavigationGroup = ko.observable((function () {
                                    var groupsCount = 0;
                                    var singleGroupToExpand;
                                    for (var i = 0, len = model.navigationGroups.length; i < len; i++) {
                                        var group = model.navigationGroups[i];
                                        if (group.shownItems()) {
                                            if (groupsCount) {
                                                return null;
                                            }
                                            singleGroupToExpand = group;
                                            groupsCount++;
                                        }
                                    }
                                    return singleGroupToExpand;
                                })());

                                model.onNavigationSelectionChanged = ko.computed(function () {
                                    var currentNavigationItem = Navigation.currentNavigationItem();
                                    var currentNavigationGroup = Navigation.currentNavigationGroup();
                                    if (currentNavigationItem) {
                                        currentNavigationGroup = currentNavigationItem.navigationGroup;
                                        model.navigationPaneShown(currentNavigationItem.type == "home" && (!currentNavigationGroup.authenticationTargetDisplay || !currentNavigationGroup.authenticationTargetDisplay()));

                                        if (currentNavigationGroup != Navigation.topNavigationGroup) {
                                            model.expandedNavigationGroup(currentNavigationGroup);
                                        }
                                    } else if (currentNavigationGroup) {
                                        model.navigationPaneShown(false);
                                        model.expandedNavigationGroup(currentNavigationGroup);
                                    } else {
                                        model.navigationPaneShown(true);
                                    }

                                    if (currentNavigationGroup && model.visitedNavigationGroups.indexOf(currentNavigationGroup) == -1) {
                                        model.visitedNavigationGroups.push(currentNavigationGroup);
                                    }
                                });

                                model.onExpandedNavigationGroupChanged = model.expandedNavigationGroup.subscribe(function () {
                                    var navGroup = model.expandedNavigationGroup();
                                    if (navGroup) {
                                        var targetDisplay = navGroup.authenticationTargetDisplay && navGroup.authenticationTargetDisplay();
                                        if (targetDisplay && targetDisplay.authenticationMode == "on-access" && targetDisplay.navigationGroup() != navGroup) {
                                            targetDisplay.navigationGroup(navGroup);
                                            targetDisplay.accessed(true);
                                        }
                                    }
                                });

                                model.shownTargetDisplay = ko.computed(function () {
                                    var navigationItem = Navigation.currentNavigationItem();
                                    if (navigationItem) {
                                        return (navigationItem.navigationGroup && navigationItem.navigationGroup.authenticationTargetDisplay && navigationItem.navigationGroup.authenticationTargetDisplay()) || (!navigationItem.hidden() && navigationItem.targetDisplay);
                                    } else {
                                        var navigationGroup = Navigation.currentNavigationGroup();
                                        if (navigationGroup) {
                                            return navigationGroup.authenticationTargetDisplay();
                                        }
                                    }
                                });

                                model.onTopBarEvent = function (targetDisplay, e, topBar) {
                                    Navigation.onTopBarEvent(targetDisplay, e, topBar);
                                };

                                _this.setInitialized();
                            });

                            return model;
                        };

                        Frame.prototype.setInitialized = function () {
                            var _this = this;
                            this.updateTitleBar = ko.computed(function () {
                                var currentNavigationItem = Navigation.currentNavigationItem();
                                if (!currentNavigationItem) {
                                    window.document.title = _this.model.localize("apphost.apptitle");
                                } else {
                                    window.document.title = _this.model.localize("apphost.apptitle") + " - " + _this.model.getNavigationItemName(currentNavigationItem);
                                }
                            });

                            this.initialized(true);
                        };
                        return Frame;
                    })(SDL.UI.Core.Views.ViewBase);
                    Views.Frame = Frame;

                    Frame.prototype.disposeInterface = SDL.Client.Types.OO.nonInheritable(function SDL$Client$Frame$Views$Frame$disposeInterface() {
                        if (this.updateTitleBar) {
                            this.updateTitleBar.dispose();
                            this.updateTitleBar = null;
                        }

                        if (this.model) {
                            var model = this.model;
                            if (model.shownTargetDisplay) {
                                model.shownTargetDisplay.dispose();
                                model.shownTargetDisplay = null;
                            }
                            if (model.onNavigationSelectionChanged) {
                                model.onNavigationSelectionChanged.dispose();
                                model.onNavigationSelectionChanged = null;
                            }
                            if (model.onExpandedNavigationGroupChanged) {
                                model.onExpandedNavigationGroupChanged.dispose();
                                model.onExpandedNavigationGroupChanged = null;
                            }
                            if (model.navigationPaneToggleShown) {
                                model.navigationPaneToggleShown.dispose();
                                model.navigationPaneToggleShown = null;
                            }

                            model.dispose();
                            this.model = null;
                        }
                    });

                    SDL.Client.Types.OO.createInterface("SDL.Client.UI.ApplicationHost.Views.Frame", Frame);
                })(ApplicationHost.Views || (ApplicationHost.Views = {}));
                var Views = ApplicationHost.Views;
            })(UI.ApplicationHost || (UI.ApplicationHost = {}));
            var ApplicationHost = UI.ApplicationHost;
        })(Client.UI || (Client.UI = {}));
        var UI = Client.UI;
    })(SDL.Client || (SDL.Client = {}));
    var Client = SDL.Client;
})(SDL || (SDL = {}));
//# sourceMappingURL=Frame.js.map
/* RIGHT-HAND SIDE WHERE APPLICATIONS ARE SHOWN */
.frame-applications,
.frame-applications div,
.frame-applications iframe {
  position: absolute;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  height: auto;
  width: auto;
  margin: 0;
  padding: 0;
  border: none;
}
.frame-applications iframe {
  width: 100%;
  height: 100%;
}
.frame-applications {
  background-color: #eee;
  overflow: hidden;
}
.frame-applications .frame-application-scroll-wrapper {
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.frame-applications > .frame-application-animated {
  transition: margin .6s;
}
.frame-applications > .frame-application-out {
  margin-left: 246px;
}
.frame-applications > .frame-application-hidden {
  z-index: -1;
  left: 100%;
  /* needed to enable proper scrolling on iPad */
  right: -100%;
}
/* TOP BAR */
.frame-application-with-topbar > .frame-application-scroll-wrapper {
  top: 31px;
}
.frame-application-with-topbar > span {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  width: auto;
}
/* NAVIGATION PANEL */
.frame-navigation {
  display: none;
  /* this is to prevent animation immediately after loading the page */
  position: absolute;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  top: 0;
  height: 100%;
  width: 246px;
  margin: 0;
  padding: 0;
  border: 1px solid #262933;
  background-color: #474E58;
  outline: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
  transition: left .6s;
}
.frame-navigation-shown {
  display: block;
  left: 0;
  box-shadow: 2px 1px 10px #5C636D;
}
.frame-navigation-hidden {
  display: block;
  left: -246px;
  box-shadow: none;
}
.frame-navigation-pane {
  position: relative;
  height: 100%;
  width: 100%;
  overflow: hidden;
  color: #FFF;
  font-family: Arial;
  font-size: 13px;
  font-weight: normal;
  text-shadow: 0 1px #2B2F36;
  cursor: default;
}
.frame-navigation-logo {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 30px;
  width: 100%;
  margin: 0;
  padding: 0;
  border-left: none;
  border-right: none;
  border-top: 1px solid #5C636D;
  border-bottom: 1px solid #353B46;
  background-color: #454B53;
  background-position: 0 0;
}
/* all navigation options */
.frame-navigation-pane ul {
  width: 100%;
  margin: 0;
  padding: 0;
  list-style: none outside none;
}
.frame-navigation-option:hover {
  background-color: #576172 !important;
}
.frame-navigation-option-selected,
.frame-navigation-option-selected:hover {
  background-color: #296ACC !important;
}
.frame-navigation-option-icon,
.frame-navigation-option-text,
.frame-navigation-option-right {
  display: table-cell;
  margin: 0;
  padding: 0;
  border: none;
}
.frame-navigation-option-text {
  overflow: hidden;
  text-overflow: ellipsis;
}
.frame-navigation-option-icon,
.frame-navigation-option-right {
  background-repeat: no-repeat;
  background-position: left center;
}
.frame-navigation-option-right {
  background-clip: content-box;
  width: 17px;
  box-sizing: content-box;
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box;
  padding: 12px 0 11px 0;
  line-height: 16px;
}
/* top area with big buttons */
ul.frame-navigation-top {
  position: relative;
  border: none;
  border-bottom: 1px solid #262933;
  display: table;
  table-layout: fixed;
  box-shadow: 0 7px 10px #474E58;
  z-index: 1;
  /* this is to show the border box shadow on top of the element under */
}
.frame-navigation-top li:not(:only-child) {
  display: table-cell;
  height: 79px;
  margin: 0;
  padding: 0;
  border-top: 1px solid #5C636D;
  border-left: 1px solid #5C636D;
  border-right: 1px solid #353B46;
  border-bottom: none;
  overflow: hidden;
  vertical-align: bottom;
  text-align: center;
}
.frame-navigation-top li:first-child:not(:only-child) {
  border-left: none;
}
.frame-navigation-top li:last-child:not(:only-child) {
  border-right: 3px solid #5C636D;
}
.frame-navigation-top li:not(:only-child) .frame-navigation-option-text {
  display: block;
  padding-top: 1px;
  min-height: 31px;
  max-height: 48px;
}
/* middle (scrollable) area with expandable groups */
.frame-navigation-middle {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  position: absolute !important;
  bottom: 0px;
  width: 100%;
}
.frame-navigation-pane-no-top .frame-navigation-middle {
  top: 30px;
}
.frame-navigation-pane-one-top .frame-navigation-middle {
  top: 72px;
}
.frame-navigation-pane-full-top .frame-navigation-middle {
  top: 111px;
}
.frame-navigation-middle-background {
  position: absolute;
  top: 0;
  right: 0;
  height: 100%;
  width: 3px;
  margin: 0;
  padding: 0;
  border: none;
  background-color: #5c636D;
}
.frame-navigation-middle li {
  display: block;
  padding: 0;
  margin: 0;
}
.frame-navigation-middle li > div,
.frame-navigation-group li,
.frame-navigation-top li:only-child {
  display: table;
  table-layout: fixed;
  margin: 0;
  padding: 0;
  padding-left: 15px;
  border: none;
  height: 40px;
  box-sizing: content-box;
  /* iPad doesn't seem to appreciate border-box => have to use content-box + fixed width in pixels rather than 100% */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box;
  border-top: 1px solid #5C636D;
}
.frame-navigation-middle li > div,
.frame-navigation-group li {
  width: 212px;
  border-bottom: 1px solid #353B46;
}
.frame-navigation-top li:only-child {
  width: 226px;
}
.frame-navigation-middle .frame-navigation-option-icon,
.frame-navigation-top li:only-child .frame-navigation-option-icon {
  width: 16px;
  padding: 12px 9px 11px 0px;
  background-clip: content-box;
  box-sizing: content-box;
  -moz-box-sizing: content-box;
  line-height: 17px;
}
.frame-navigation-middle .frame-navigation-option-text,
.frame-navigation-top li:only-child .frame-navigation-option-text {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  display: table-cell;
  vertical-align: middle;
  white-space: nowrap;
}
.frame-navigation-group {
  background-color: #576172;
}
.frame-navigation-group ul {
  overflow: hidden;
  transition: height .6s;
}
.frame-navigation-group-collapsed ul {
  height: 0;
}
.frame-navigation-group:only-child > div > .frame-navigation-option-right {
  background-image: none;
}
.frame-navigation-group > div > .frame-navigation-option-right {
  background-position: -106px -43px;
}
.frame-navigation-group-collapsed > div > .frame-navigation-option-right {
  background-position: -120px -44px;
}
.frame-navigation-middle .frame-navigation-option,
.frame-navigation-top .frame-navigation-option:only-child {
  background-color: #474E58;
  border-right: 3px solid #5c636D;
}
.frame-navigation-group li {
  padding-right: 14px;
}
.frame-navigation-group li.frame-navigation-option-selected,
.frame-navigation-group li:hover,
.frame-navigation-top li.frame-navigation-option-selected:only-child,
.frame-navigation-top li:only-child:hover {
  border-right: none;
}
.frame-navigation-middle li > div,
.frame-navigation-group li.frame-navigation-option-selected,
.frame-navigation-group li:hover {
  padding-right: 17px;
}
.frame-navigation-top li:only-child:hover,
.frame-navigation-top li.frame-navigation-option-selected:only-child {
  padding-right: 3px;
}
.frame-navigation-middle .frame-navigation-option-external {
  background-position: -51px -44px;
}
/* buttons icons */
.frame-navigation-top li:not(:only-child) .frame-navigation-option-icon {
  display: inline-block;
  width: 24px;
  height: 24px;
  margin-bottom: 3px;
  background-position: center center;
}
.frame-navigation-top li:not(:only-child) .frame-navigation-option-home {
  background-position: -25px -29px;
}
.frame-navigation-top li:not(:only-child) .frame-navigation-option-activities {
  background-position: 0 -29px;
}
.frame-navigation-top li:not(:only-child) .frame-navigation-option-settings {
  background-position: -49px -29px;
}
.frame-navigation-top li:only-child .frame-navigation-option-home,
.frame-navigation-option-home {
  background-position: -35px -44px;
}
.frame-navigation-option-activities {
  background-position: -91px -18px;
}
.frame-navigation-option-settings {
  background-position: -74px -18px;
}
.frame-navigation-option-help {
  background-position: 0 -44px;
}
.frame-navigation-option-about {
  background-position: -17px -44px;
}
/* Log in option */
.frame-navigation-group li.frame-navigation-option-login {
  height: 86px;
  padding-left: 0;
  width: 227px;
  text-align: center;
}
.frame-navigation-group li.frame-navigation-option-login .frame-navigation-option-text {
  white-space: normal;
  padding-left: 7px;
}
.frame-navigation-group li.frame-navigation-option-login .frame-navigation-option-icon {
  display: inline-block;
  padding: 0;
  height: 17px;
  width: 17px;
  line-height: 17px;
  margin-bottom: 3px;
  background-position: -108px -30px;
}
/* TOGGLE BUTTON FOR SHOWING/HIDING THE NAVIGATION PANE */
.frame-navigation-toggle {
  position: absolute;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  top: -1px;
  right: -32px;
  height: 31px;
  width: 32px;
  margin: 0;
  padding: 0;
  border: 1px solid #262933;
  background-color: #296ACC;
  overflow: hidden;
}
.frame-navigation-hidden .frame-navigation-toggle {
  right: -33px;
  border-top-color: #353B46;
  border-bottom-color: #353B46;
  border-left-style: none;
  border-right-style: none;
  background-color: #454B53;
}
.frame-navigation-hidden .frame-navigation-toggle:hover {
  border-top-color: #262933;
  border-bottom-color: #262933;
  border-left-style: solid;
  border-right-style: solid;
  background-color: #296ACC;
}
.frame-navigation-toggle div {
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  height: 100%;
  width: 100%;
  border: none;
  border-top: 1px solid #5B8EDE;
  background-position: -79px -50px;
  padding: 6px 7px;
  background-clip: content-box;
}
.frame-navigation-hidden .frame-navigation-toggle div {
  border-top-color: #5C636D;
  padding: 6px 8px;
  background-position: -61px -50px;
}
.frame-navigation-hidden .frame-navigation-toggle:hover div {
  border-top-color: #5B8EDE;
  padding: 6px 7px;
  background-position: -79px -50px;
}
.frame-navigation-logo,
.frame-navigation-toggle div,
.frame-navigation-option-right,
.frame-navigation-group li.frame-navigation-option-login .frame-navigation-option-icon,
.frame-navigation-option-home,
.frame-navigation-option-activities,
.frame-navigation-option-settings,
.frame-navigation-option-help,
.frame-navigation-option-about {
  background-repeat: no-repeat;
  background-image: url("data:image/png;base64,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");
}
SDL.Globalize.addCultureInfo( "default", {
    messages: {
		"apphost.apptitle": "SDL",
        "apphost.home": "Home",
		"apphost.settings": "Settings",
		"apphost.activities": "Activities",
		"apphost.help": "Help",
		"apphost.about": "About",
		"apphost.loading": "Loading",
		"apphost.login": "Log in",
		"apphost.toaccess": "{0} to access this feature"
    }
});<div id='SDL.Client.UI.ApplicationHost.Views.Frame' type='text/html+knockout'>
	<div data-bind="attr: {lang: culture}">
		<!-- ko if: !initialized() -->
			<div class="frame-application-loading" data-bind="control: {
					type: 'SDL.UI.Controls.Knockout.ActivityIndicator',
					data: { text: $root.localize('apphost.loading') }}">
			</div>
		<!-- /ko -->
		<!-- ko if: initialized -->
			<div class="frame-applications" data-bind="foreach: navigationItemTargetDisplays.concat(authenticationTargetDisplays),
					event: {scroll: function() {$element.scrollLeft = 0;}}">
				<div data-bind="if: accessed() && !disposed(),
								css: {'frame-application-out': $root.isTargetDisplayOut($data),
									'frame-application-animated': $root.isTargetDisplaySlideAnimated($data, $element),
									'frame-application-hidden': $data != $root.shownTargetDisplay(),
									'frame-application-with-topbar': topBarShown}">
					<!-- ko if: topBarShown -->
						<span data-bind="control: {
								type: 'SDL.UI.Controls.Knockout.TopBar',
								data: {
										ribbonTabs: topBarOptions().ribbonTabs,
										selectedRibbonTabId: topBarOptions().selectedRibbonTabId,
										buttons: topBarOptions().buttons,
										ribbonTabsFlyoutMenuShown: $data == $root.shownTargetDisplay() && null,
										hostMode: true
									},
								events: {'*': $root.onTopBarEvent}}">
						</span>
					<!-- /ko -->
					<div class="frame-application-scroll-wrapper">
						<iframe data-bind="attr: { src: src, foo: $root.registerTargetDisplayFrame($data, $element) },
							event: {load: function() {loaded(true);}, focus: $root.blurredNavigationPane}"></iframe>
					</div>
					<!-- ko if: $root.setTargetDisplayLocation($data, $element) -->
						<!-- setting iframe's location via javascript to:
							1. manage history (using location.replace())
							2. do not reload if the change is only a hash parameter
						-->
					<!-- /ko -->
					<!-- ko if: loading -->
						<div class="frame-application-loading" data-bind="control: {
								type: 'SDL.UI.Controls.Knockout.ActivityIndicator',
								data: { text: $root.localize('apphost.loading') }}">
						</div>
					<!-- /ko -->
				</div>
			</div>

			<div class="frame-navigation" data-bind="css: {'frame-navigation-hidden': !navigationPaneShown(), 'frame-navigation-shown': navigationPaneShown},
						event: {blur: blurredNavigationPane}" tabIndex="0">
				<div class="frame-navigation-toggle" data-bind="click: toggleNavigationPane, visible: navigationPaneToggleShown"><div></div></div>
				<div class="frame-navigation-pane" data-bind="css: {
						'frame-navigation-pane-no-top': !topNavigationGroup.shownItems(),
						'frame-navigation-pane-one-top': topNavigationGroup.shownItems() == 1,
						'frame-navigation-pane-full-top': topNavigationGroup.shownItems() > 1}">
					<div class="frame-navigation-logo" unselectable="on"></div>
					<!-- ko if: topNavigationGroup.shownItems() > 0 -->
						<ul class="frame-navigation-top" data-bind="foreach: topNavigationGroup.navigationItems">
							<li class="frame-navigation-option" unselectable="on"
								data-bind="css: { 'frame-navigation-option-selected': $data == $root.currentNavigationItem() },
									click: $root.selectNavigationItem">
								<span class = "frame-navigation-option-icon" unselectable="on"
									data-bind="css: {'frame-navigation-option-home': $data.type == 'home' && !($parent.topNavigationGroup.shownItems() > 1 && $data.topIcon || $data.icon)},
											attr: {style: ($parent.topNavigationGroup.shownItems() > 1 && $data.topIcon || $data.icon)
												? 'background-image: url(\'' + ($parent.topNavigationGroup.shownItems() > 1 && $data.topIcon || $data.icon) + '\')' : ''}">&nbsp;</span>
								<span class="frame-navigation-option-text" data-bind="text: $root.getNavigationItemName($data)" unselectable="on"></span>
							</li>
						</ul>
					<!-- /ko -->
					<div class="frame-navigation-middle" data-bind="control: {type: 'SDL.UI.Controls.Knockout.ScrollView', data: {overflowX: 'hidden', style: 'dark', overlay: true}}">
						<div class="frame-navigation-middle-background"></div>
						<div data-sdl-scrollview-child='true' unselectable="on">
							<ul data-bind="foreach: navigationGroups">
								<!-- ko if: $data.shownItems() > 0 -->
									<li class="frame-navigation-group" data-bind="css: { 'frame-navigation-group-collapsed': $data != $root.expandedNavigationGroup() }">
										<div unselectable="on" data-bind="click: $root.toggleExpandNavigationGroup">
											<span class="frame-navigation-option-text"
												data-bind="text: $root.getNavigationGroupName($data)" unselectable="on"></span>
											<span class="frame-navigation-option-right" unselectable="on">&nbsp;</span>
										</div>

										<!-- ko if: $data.authenticationTargetDisplay && $data.authenticationTargetDisplay() -->
											<ul data-bind="style: {height: ($data == $root.expandedNavigationGroup() ? 88 : 0) + 'px'}">
												<li class="frame-navigation-option frame-navigation-option-login"
													data-bind="css: { 'frame-navigation-option-selected':
																	$root.currentNavigationItem() ? $data == $root.currentNavigationItem().navigationGroup : $data == $root.currentNavigationGroup() },
														click: $root.selectNavigationGroup">
													<span class="frame-navigation-option-text" unselectable="on">
														<!-- ko if: authenticationTargetDisplay().loading() -->
															<div style="position: relative" data-bind="control: {
																	type: 'SDL.UI.Controls.Knockout.ActivityIndicator',
																	data: { screen: 'none', size: 'medium' }}">
															</div>
														<!-- /ko -->
														<!-- ko if: !authenticationTargetDisplay().loading() -->
															<span class="frame-navigation-option-icon" unselectable="on">&nbsp;</span><br/>
															<span data-bind="html: $root.localize('apphost.toaccess', ['<strong>' + $root.localize('apphost.login') + '</strong>'])"></span>
														<!-- /ko -->
													</span>
												</li>
											</ul>
										<!-- /ko -->

										<!-- ko if: !$data.authenticationTargetDisplay || !$data.authenticationTargetDisplay() -->
											<ul data-bind="foreach: navigationItems, style: {height: ($data == $root.expandedNavigationGroup() ? shownItems() * 42 : 0) + 'px'}">
												<!-- ko if: !$data.hidden() && !$data.contextual() -->
													<li class="frame-navigation-option"
														data-bind="css: { 'frame-navigation-option-selected': $data == $root.currentNavigationItem() },
															click: $root.selectNavigationItem">
														<span class = "frame-navigation-option-icon" unselectable="on"
															data-bind="css: {'frame-navigation-option-home': !$data.icon && $data.type == 'home',
																	'frame-navigation-option-activities': !$data.icon && $data.type == 'activities',
																	'frame-navigation-option-settings': !$data.icon && $data.type == 'settings',
																	'frame-navigation-option-help': !$data.icon && $data.type == 'help',
																	'frame-navigation-option-about': !$data.icon && $data.type == 'about'},
																	attr: {style: $data.icon ? 'background-image: url(\'' + $data.icon + '\')' : ''}">&nbsp;</span>
														<span class="frame-navigation-option-text" data-bind="text: $root.getNavigationItemName($data)" unselectable="on"></span>
														<!-- ko if: $data.external -->
															<span class="frame-navigation-option-right frame-navigation-option-external" unselectable="on">&nbsp;</span>
														<!-- /ko -->
													</li>
												<!-- /ko -->
											</ul>
										<!-- /ko -->
									</li>
								<!-- /ko -->
							</ul>
						</div>
					</div>
				</div>
			</div>
		<!-- /ko -->
	</div>
</div>